<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="assets/images/cybersleuth-icon.png" type="image/png">
    <title>CyberSleuth Academy Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <!-- Bootstrap & Font Awesome -->
    <link href="node_modules/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="css/leaderboard.css">
</head>
<body class="lab-page">
    <!-- Header -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark sticky-top">
        <!-- Alert container for JS -->
        <div id="alertArea" class="container position-fixed top-0 start-50 translate-middle-x mt-3"
            style="z-index: 1055; max-width: 600px;"></div>

        <div class="container">
            <!-- Logo and Brand -->
            <a class="navbar-brand d-flex align-items-center me-4" href="index.html" target="_blank">
                <img src="assets/images/cybersleuth-icon.png" alt="Logo" style="height: 22px;" class="me-2">
                CyberSleuth Academy
            </a>

            <!-- Collapse toggle for mobile -->
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNavbar"
                aria-controls="mainNavbar" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <!-- Navbar Content -->
            <div class="collapse navbar-collapse" id="mainNavbar">
                <!-- Left Links -->
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a href="home.html" class="nav-link">Dashboard</a>
                    </li>
                    <li class="nav-item">
                        <a href="learn.html" class="nav-link">Learn</a>
                    </li>
                    <li class="nav-item">
                        <a href="leaderboard.html" class="nav-link active">Compete</a>
                    </li>
                    <li class="nav-item">
                        <a href="quiz.html" class="nav-link">Content</a>
                    </li>
                </ul>

                <!-- Right Tools -->
                <ul class="navbar-nav ms-auto align-items-center gap-3">
                    <!-- Search -->
                    <li class="nav-item">
                        <form class="d-flex align-items-center" role="search">
                            <input type="text"
                                class="form-control form-control-sm bg-dark text-white border border-secondary me-2"
                                placeholder="Search" aria-label="Search">
                            <button type="submit" class="btn btn-outline-success btn-sm">Search</button>
                        </form>
                    </li>


                    <!-- Settings Dropdown (only shows if body.lab-page is present) -->
                    <li class="nav-item dropdown settings-dropdown d-none">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                            <i class="fas fa-cog me-1"></i> Settings
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><a class="dropdown-item" href="#" data-bs-toggle="modal"
                                    data-bs-target="#difficultyModal">
                                    <i class="fas fa-sliders-h me-2"></i>Difficulty Level</a></li>
                            <li><a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#resetModal">
                                    <i class="fas fa-redo me-2"></i>Reset Progress</a></li>
                            <li>
                                <div class="dropdown-item d-flex align-items-center" onclick="event.stopPropagation();">
                                    <span class="me-2"><i class="fas fa-moon"></i> Dark Mode</span>
                                    <label class="theme-toggle ms-auto mb-0">
                                        <input type="checkbox" id="darkModeToggle" />
                                        <span class="slider"></span>
                                    </label>
                                </div>
                            </li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container-fluid mt-4">
        <div class="leaderboard-section">
            <h1 class="leaderboard-title">Leaderboards</h1>
            <p class="leaderboard-welcome">Welcome to the wall of fame - Here are some of our top users.</p>

            <!-- Filters -->
            <div class="filters d-flex flex-wrap gap-3 mb-4">
                <button class="filter-button btn btn-outline-success active" data-period="all-time">General</button>
                <button class="filter-button btn btn-outline-success" data-period="monthly">All time</button>
                <select class="filter-select form-select w-auto" id="countryFilter">
                    <option value="all">All countries</option>
                    <option value="US">US</option>
                    <option value="UK">UK</option>
                    <option value="SG">SG</option>
                </select>
            </div>

            <!-- Top Users (Highlighted) -->
            <div class="top-users mb-4">
                <!-- Top users will be populated by JavaScript -->
            </div>

            <!-- Leaderboard Table -->
            <div class="table-container">
                <table class="leaderboard-table table table-dark table-hover">
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>Username</th>
                            <th>Country</th>
                            <th>Points</th>
                            <th>Rooms</th>
                        </tr>
                    </thead>
                    <tbody id="leaderboardBody">
                        <!-- Table rows will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
    </main>

    <footer class="footer mt-auto bg-dark text-white py-4">
        <div class="container-fluid">
            <div class="text-center">
                <p>Â© 2025 CyberSleuth Academy. Developed by TP Cybersecurity & Digital Forensics Students.</p>
                <p class="mb-0">All content is for educational purposes only.</p>
            </div>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="node_modules/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Sample user data (only General/All Time users, no Weekly)
        const userData = [
            { rank: 1, username: "Jack", points: 200, rooms: 2, country: "US", profilePic: "user1.jpg", period: "all-time" },
            { rank: 2, username: "John", points: 199, rooms: 2, country: "UK", profilePic: "user2.jpg", period: "all-time" },
            { rank: 3, username: "Tim", points: 198, rooms: 2, country: "SG", profilePic: "user3.jpg", period: "all-time" },
            { rank: 4, username: "Jane", points: 197, rooms: 2, country: "US", profilePic: "user4.jpg", period: "all-time" },
            { rank: 5, username: "Mary", points: 196, rooms: 2, country: "US", profilePic: "user5.jpg", period: "all-time" },
            { rank: 6, username: "Tom", points: 195, rooms: 2, country: "SG", profilePic: "user6.jpg", period: "monthly" },
            { rank: 7, username: "Harry", points: 194, rooms: 2, country: "SG", profilePic: "user7.jpg", period: "monthly" },
            { rank: 8, username: "Thomas", points: 193, rooms: 2, country: "SG", profilePic: "user8.jpg", period: "monthly" },
            { rank: 9, username: "Angel", points: 192, rooms: 2, country: "US", profilePic: "user9.jpg", period: "monthly" },
            { rank: 10, username: "Bob", points: 190, rooms: 2, country: "US", profilePic: "user10.jpg", period: "monthly" }
        ];

        // DOM elements
        const filterButtons = document.querySelectorAll('.filter-button');
        const countryFilter = document.getElementById('countryFilter');
        const leaderboardBody = document.getElementById('leaderboardBody');
        const topUsersContainer = document.querySelector('.top-users');

        // Current filter state
        let currentPeriod = 'all-time';
        let currentCountry = 'all';

        // Initialize the page
        document.addEventListener('DOMContentLoaded', () => {
            // Add event listeners to filter buttons
            filterButtons.forEach(button => {
                button.addEventListener('click', () => {
                    // Update active button
                    filterButtons.forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    
                    // Update current period
                    currentPeriod = button.dataset.period || 'all-time';
                    
                    // Apply filters
                    applyFilters();
                });
            });
            
            // Add event listener to country filter
            countryFilter.addEventListener('change', () => {
                currentCountry = countryFilter.value;
                applyFilters();
            });
            
            // Initial render
            applyFilters();
        });

        // Apply filters and update the leaderboard
        function applyFilters() {
            // Filter data based on current selections
            let filteredData = userData.filter(user => {
                // Filter by period
                if (currentPeriod !== 'all-time' && user.period !== currentPeriod) {
                    return false;
                }
                
                // Filter by country
                if (currentCountry !== 'all' && user.country !== currentCountry) {
                    return false;
                }
                
                return true;
            });
            
            // Sort by points (descending)
            filteredData.sort((a, b) => b.points - a.points);
            
            // Update ranks
            filteredData.forEach((user, index) => {
                user.rank = index + 1;
            });
            
            // Get top users (first 5)
            const topUsers = filteredData.slice(0, 5);
            
            // Render top users
            renderTopUsers(topUsers);
            
            // Render table rows (excluding top users)
            renderTableRows(filteredData, topUsers);
        }

        // Render top users section
        function renderTopUsers(users) {
            topUsersContainer.innerHTML = '';
            
            if (users.length === 0) {
                topUsersContainer.innerHTML = '<p class="no-users">No users match the current filters.</p>';
                return;
            }
            
            users.forEach(user => {
                const topUserElement = document.createElement('div');
                topUserElement.className = 'top-user card bg-dark text-white mb-3';
                topUserElement.innerHTML = `
                    <div class="card-body d-flex align-items-center">
                        <span class="rank fs-4 fw-bold me-3">${user.rank}</span>
                        <img src="${user.profilePic}" alt="${user.username}" class="profile-pic rounded-circle me-3" style="width: 60px; height: 60px;">
                        <div class="user-info flex-grow-1">
                            <h5 class="mb-1">${user.username}</h5>
                            <p class="mb-1">Points: ${user.points}</p>
                            <p class="mb-1">Rooms in: ${user.rooms}</p>
                            <p class="mb-0">Country: ${user.country}</p>
                        </div>
                    </div>
                `;
                topUsersContainer.appendChild(topUserElement);
            });
        }

        // Render table rows
        function renderTableRows(allUsers, topUsers) {
            leaderboardBody.innerHTML = '';
            
            // Create a set of top user usernames for quick lookup
            const topUsernames = new Set(topUsers.map(user => user.username));
            
            // Filter out top users from the table data
            const tableUsers = allUsers.filter(user => !topUsernames.has(user.username));
            
            if (tableUsers.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = '<td colspan="5" class="text-center">No additional users match the current filters.</td>';
                leaderboardBody.appendChild(row);
                return;
            }
            
            tableUsers.forEach(user => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${user.rank}</td>
                    <td>
                        <img src="${user.profilePic}" alt="${user.username}" class="profile-pic-small rounded-circle me-2" style="width: 30px; height: 30px;">
                        ${user.username}
                    </td>
                    <td>${user.country}</td>
                    <td>${user.points}</td>
                    <td>${user.rooms}</td>
                `;
                leaderboardBody.appendChild(row);
            });
        }
    </script>
</body>
</html>